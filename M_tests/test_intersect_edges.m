%edges1 = [0,0.2,0.8,-0.2;
%          0,0.5,1,-0.5];
%edges1 = [0,0.5,0.8,0.5;
%          0,0.5,1,-0.5];
%edges1 = [0,-0.5,0.5,0.5;
%          0.5,0.5,1.0,-0.4];
%edges1 = [0,0,1,0];
%edges1 = [0,0,1,0;
%          1,0,0,2];
%edges1 = [0,1.0,1.0,1.0];
%edges1 = [0.05,0,0.05,0.05];
%edges1 = [0.02,0.1,0.02,0.02;
%          0.02,0.02,0.13,0.02];

%edges2 = [0.2,0,0.8,0];
%edges2 = [0.05,0,0.05,0.01];
%edges2 = [0.015,0.02,0.02,0.02];
%edges2 = [0.02,0.02,0.025,0.02];

%edges1 = [1.620603978633881e-02     9.142089843750001e-02     1.620605468750000e-02     1.640136718750000e-02;
%         1.620605468750000e-02     1.640136718750000e-02     1.173535156250000e-01     1.620605468750000e-02];
%edges2 = [0.015, 0.015, 0.02, 0.02];
%edges1 = [0,0,1,0];
%edges2 = [0.1,0,0.9,0];

%{
edges1 = [1.450000000000000e-01     1.950000000000000e-01     1.450000000000000e-01     1.950000000000000e-01];
edges2 = [ 5.000000000000000e-03     1.834630000000000e-01     1.450000000000000e-01     1.950000000000000e-01
     1.450000000000000e-01     1.489910000000000e-01     1.450000000000000e-01     1.950000000000000e-01
     7.790430000000000e-03     5.000000000000000e-03     1.450000000000000e-01     1.950000000000000e-01
     5.000000000000000e-03     6.221270000000000e-02     1.213670000000000e-01     1.575140000000000e-01
     8.226180000000000e-02     1.110180000000000e-01     1.450000000000000e-01     9.986100000000001e-02
     5.000000000000000e-03     1.231830000000000e-01     4.333890000000000e-02     7.094910000000000e-02
     5.000000000000000e-03     5.000000000000000e-03     1.450000000000000e-01     1.382440000000000e-02
     5.000000000000000e-03     5.000000000000000e-03     5.000000000000000e-03     5.000000000000000e-03
     5.000000000000000e-03     5.000000000000000e-03     9.061909999999999e-02     5.000000000000000e-03
     1.450000000000000e-01     1.950000000000000e-01     5.000000000000000e-03     1.834630000000000e-01
     5.000000000000000e-03     1.834630000000000e-01     1.450000000000000e-01     1.489910000000000e-01
     1.450000000000000e-01     1.489910000000000e-01     7.790430000000000e-03     5.000000000000000e-03
     7.790430000000000e-03     5.000000000000000e-03     5.000000000000000e-03     6.221270000000000e-02
     5.000000000000000e-03     6.221270000000000e-02     8.226180000000000e-02     1.110180000000000e-01
     8.226180000000000e-02     1.110180000000000e-01     5.000000000000000e-03     1.231830000000000e-01
     5.000000000000000e-03     1.231830000000000e-01     5.000000000000000e-03     5.000000000000000e-03
     1.450000000000000e-01     1.950000000000000e-01     1.450000000000000e-01     1.950000000000000e-01
     1.450000000000000e-01     1.950000000000000e-01     1.450000000000000e-01     1.950000000000000e-01
     1.450000000000000e-01     1.950000000000000e-01     1.213670000000000e-01     1.575140000000000e-01
     1.213670000000000e-01     1.575140000000000e-01     1.450000000000000e-01     9.986100000000001e-02
     1.450000000000000e-01     9.986100000000001e-02     4.333890000000000e-02     7.094910000000000e-02
     4.333890000000000e-02     7.094910000000000e-02     1.450000000000000e-01     1.382440000000000e-02
     1.450000000000000e-01     1.382440000000000e-02     9.061909999999999e-02     5.000000000000000e-03
     9.061909999999999e-02     5.000000000000000e-03     1.500000000000000e-01     1.100000000000000e-02];
%}

% multiple coincident edges
edges1 = [0,0,1,0];
edges2 = [-0.2,0,0.5,0;
          0.8,0,1.5,0;
          0.1,0,0.7,0;
          1.1,0,1.5,0;
          0,1.0,1,1.0];
edges1lengths = sqrt((edges1(:,3)-edges1(:,1)).^2 + (edges1(:,4)-edges1(:,2)).^2);
totLength = sum(edges1lengths);
cumSumLengths = [0;cumsum(edges1lengths)];

figure
hold on
for i = 1:size(edges1,1)
    plot(edges1(i,1:2:end),edges1(i,2:2:end),'b-','linewidth',2)
end

for i = 1:size(edges2,1)
    plot(edges2(i,1:2:end),edges2(i,2:2:end),'k--','linewidth',2)
end
[intPts,intPars1,intPars2,intInd,coincident] ...
    = intersect_edges(edges1,edges2)

plot(intPts(1,:),intPts(2,:),'ro','markerfacecolor','r')

k = channels.nurbs(5).order-1+intInd;
%intPars1new = channels.nurbs(5).knots(k)+intPars1*(channels.nurbs(5).knots(k+1)-channels.nurbs(5).knots(k))